{% extends 'base.html.twig' %}

{% block title %}Book:
	{{ book.title }}
{% endblock %}

{% block body %}
	<div class="row">
		<div class="col-md-8">
			<div class="">
				<div class="hero-content flex-col lg:flex-row">
					<img src="https://img.daisyui.com/images/stock/photo-1635805737707-575885ab0820.webp" class="max-w-sm rounded-lg shadow-2xl"/>
					<div>
						<h1 class="text-5xl font-bold">{{ book.title }}</h1>
						<div class="py-6">
							<dl class="row">
								<dd class="col-sm-9">
									<div class="badge badge-secondary">
										{% for genre in book.genres %}
											{{ genre.name }}
											{% if not loop.last %},
											{% endif %}
										{% endfor %}
									</div>
								</dd>
								<dd class="col-sm-9 my-4">{{ book.description }}</dd>
								<div class="card-actions justify-end">
									<div class="badge badge-primary">{{ book.author.firstName }}
										{{ book.author.lastName }}</div>
									<div class="badge badge-outline">{{ book.publishedAt|date('Y-m-d') }}</div>
									<div class="badge badge-outline">Page Count : {{ book.pageCount }}</div>
								</div>
							</dl>
						</div>
					</div>
				</div>
			</div>

            <h3 class="mt-4">Discussions</h3>
            {% if book.discussions|length > 0 %}
                <ul class="list bg-base-100 rounded-box shadow-md">
                    <li class="p-4 pb-2 text-xs opacity-60 tracking-wide">Latest discussions about this book</li>
                    {% for discussion in book.discussions %}
                        <li class="list-row flex gap-4 items-start py-4">
                            <div>
                                <img class="size-10 rounded-box" src="https://img.daisyui.com/images/profile/demo/1@94.webp"/>
                            </div>
                            <div class="flex-1">
                                <div class="font-semibold">
                                    {{ discussion.user is defined and discussion.user ? discussion.user.firstName ~ ' ' ~ discussion.user.lastName : 'Unknown user' }}
                                </div>
                                <div class="text-xs uppercase font-semibold opacity-60">{{ discussion.title }}</div>
                                <p class="list-col-wrap text-xs mt-1">
                                    {{ discussion.content|length > 100 ? discussion.content|slice(0, 100) ~ '...' : discussion.content }}
                                </p>
                                <div class="flex gap-4 items-center mt-2">
                                    <small class="opacity-60">{{ discussion.comments|length }} comments</small>
                                    <small class="opacity-60">{{ discussion.createdAt ? discussion.createdAt|date('Y-m-d') : '' }}</small>
                                </div>
                            </div>
                            <div class="flex flex-col gap-2">
                                <a href="{{ path('app_discussion_show', {'id': discussion.id}) }}" class="btn btn-square btn-ghost" title="View">
                                    <svg class="size-[1.2em]" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><g stroke-linejoin="round" stroke-linecap="round" stroke-width="2" fill="none" stroke="currentColor"><path d="M6 3L20 12 6 21 6 3z"></path></g></svg>
                                </a>
                            </div>
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p>No discussions yet. Be the first to start a discussion about this book!</p>
            {% endif %}

			<div class="card mt-4">
				<div class="card-header">
					<h5 class="mb-0">Start a new discussion</h5>
				</div>
				<div class="card-body">
					{% if app.user %}
						{% if not is_granted('ROLE_BANNED') %}
							{{ form_start(discussionForm) }}
							{{ form_widget(discussionForm) }}
							<div class="mt-3">
								<button type="submit" class="btn btn-primary">Submit</button>
							</div>
							{{ form_end(discussionForm) }}
						{% else %}
							<div class="alert alert-warning">
								You are banned and cannot participate in discussions.
							</div>
						{% endif %}
					{% else %}
						<div role="alert" class="alert alert-info">
							<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="h-6 w-6 shrink-0 stroke-current">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
							</svg>
							<span>
								Please
								<a href="{{ path('app_login') }}">log in</a>
								to start a discussion.
							</span>
						</div>
					{% endif %}
				</div>
			</div>

			<div class="my-3">
				<a href="{{ path('app_book_index') }}" class="btn btn-secondary">Back to list</a>
			</div>
		</div>
	</div>
{% endblock %}
